<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ວົງລໍ້ ລຸ້ນໂຊກ (Spin Wheel)</title>
<style>
  :root{
    --size: 420px;
  }
  body{
    font-family: "Segoe UI", Roboto, "Noto Sans", sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    margin:0;
    background: linear-gradient(180deg,#0f172a 0%, #071022 100%);
    color:#fff;
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border-radius:16px;
    padding:20px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.7);
    text-align:center;
    width:fit-content;
  }
  h1{ margin:0 0 10px; font-size:20px }
  .wheel-wrap{
    position:relative;
    width:var(--size);
    height:var(--size);
    margin: 14px auto;
  }
  canvas#wheel{
    width:100%;
    height:100%;
    border-radius:50%;
    display:block;
    transition: transform 6s cubic-bezier(.1,.9,.2,1);
    will-change: transform;
    box-shadow: inset 0 6px 20px rgba(0,0,0,0.45);
    background: radial-gradient(circle at center, rgba(255,255,255,0.02), transparent 40%);
  }
  /* pointer */
  .pointer{
    position:absolute;
    left:50%;
    top:-8px;
    transform:translateX(-50%);
    width:0;
    height:0;
    border-left:18px solid transparent;
    border-right:18px solid transparent;
    border-bottom:26px solid #ff4d4f;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.6));
  }
  .center{
    position:absolute;
    width:84px;
    height:84px;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    border-radius:50%;
    background:linear-gradient(180deg,#ffffff 0%, #e6eefb 100%);
    color:#0b1220;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    box-shadow: 0 6px 18px rgba(2,6,23,0.6);
  }
  .btn{
    margin-top:14px;
    display:inline-block;
    padding:10px 18px;
    font-weight:700;
    border-radius:10px;
    background: linear-gradient(90deg,#06b6d4,#7c3aed);
    color:white;
    border: none;
    cursor:pointer;
    box-shadow: 0 8px 20px rgba(124,58,237,0.18);
  }
  .btn:disabled{ opacity:0.5; cursor:default }
  .result{
    margin-top:12px;
    min-height:26px;
  }
  /* small responsive */
  @media (max-width:520px){
    :root{ --size:320px; }
  }
</style>
</head>
<body>
  <div class="card" role="application" aria-label="วงล้อลุ้นโชค">
    <h1>ວົງລໍ້ ລຸ້ນໂຊກ — LAO AI 168</h1>
    <div class="wheel-wrap" aria-hidden="false">
      <div class="pointer" aria-hidden="true"></div>
      <canvas id="wheel" width="800" height="800" role="img" aria-label="วงล้อรางวัล"></canvas>
      <div class="center" id="centerLabel">SPIN</div>
    </div>

    <button id="spinBtn" class="btn" aria-pressed="false">ສະບັບ (SPIN)</button>
    <div class="result" id="resultText" aria-live="polite"></div>
    <div style="font-size:12px;margin-top:8px;color:rgba(255,255,255,0.6)">
      ແຕະເພື່ອຫມຸນ 
    </div>
  </div>

<script>
/*
  Simple spin wheel using canvas drawing.
  ปรับ prizes[] เพื่อเปลี่ยนรายการรางวัล
*/
const prizes = [
  "1000 LAK",
  "5000 LAK",
  "IPhone 17",
  "ບໍ່ຖືກ ",
  "ຟຣີເຄດິດ 10",
  "50.000 LAK",
  "ບໍ່ຖືກ",
  "100.000 LAK "
];

const colors = [
  "#FFB6C1","#FFD580","#FFF59B","#C8E6C9","#B3E5FC","#D1C4E9","#F8BBD0","#FFE0B2"
];

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const size = canvas.width; // using square canvas
const cx = size/2, cy = size/2;
const radius = size * 0.42;
let currentRotation = 0; // degrees

function drawWheel(){
  ctx.clearRect(0,0,size,size);
  const n = prizes.length;
  const arc = (2 * Math.PI) / n;
  ctx.save();
  ctx.translate(cx, cy);

  // draw segments
  for(let i=0;i<n;i++){
    const start = -Math.PI/2 + i * arc; // start from top (12 o'clock)
    const end = start + arc;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0, radius, start, end);
    ctx.closePath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,0.4)";
    ctx.lineWidth = 2;
    ctx.stroke();

    // draw text
    ctx.save();
    const mid = start + arc/2;
    ctx.rotate(mid);
    ctx.translate(radius * 0.62, 0);
    ctx.rotate(Math.PI/2);
    ctx.fillStyle = "#0b1220";
    ctx.font = "bold 20px Arial";
    ctx.textAlign = "center";
    ctx.fillText(prizes[i], 0, 0);
    ctx.restore();
  }

  // outer ring
  ctx.beginPath();
  ctx.arc(0,0, radius+8, 0, Math.PI*2);
  ctx.lineWidth = 6;
  ctx.strokeStyle = "rgba(255,255,255,0.06)";
  ctx.stroke();

  ctx.restore();
}

drawWheel();

// Spin logic
const spinBtn = document.getElementById('spinBtn');
const resultText = document.getElementById('resultText');
const centerLabel = document.getElementById('centerLabel');

let spinning = false;

function pickTargetIndex(){
  // You can change to weighted selection if wanted
  return Math.floor(Math.random() * prizes.length);
}

function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

spinBtn.addEventListener('click', () => {
  if(spinning) return;
  spinning = true;
  spinBtn.disabled = true;
  spinBtn.setAttribute('aria-pressed','true');
  resultText.textContent = "กำลังหมุน...";
  centerLabel.textContent = "ໂຊກ";

  const n = prizes.length;
  const degPer = 360 / n;
  const targetIndex = pickTargetIndex();

  // random number of full spins (4-7)
  const fullSpins = Math.floor(Math.random()*4) + 5;
  // compute final degree so that chosen segment lands at pointer (pointer at top)
  // add half segment so the pointer hits the middle of the segment
  const finalDeg = fullSpins * 360 + (targetIndex * degPer) + degPer/2;

  const duration = 6000; // ms
  const start = performance.now();
  const startRotation = currentRotation % 360;
  const totalDelta = finalDeg - startRotation;

  function animate(now){
    const t = Math.min(1, (now - start) / duration);
    const eased = easeOutCubic(t);
    const rot = startRotation + totalDelta * eased;
    currentRotation = rot;
    canvas.style.transform = `rotate(${rot}deg)`;

    if(t < 1){
      requestAnimationFrame(animate);
    } else {
      // determine landed index for safety (calculate from currentRotation)
      const normalized = ((currentRotation % 360) + 360) % 360; // 0..360
      // since segments start at top (-90deg) when rotation = 0, and we rotated canvas,
      // the pointer (top) corresponds to angle 0. We used degPer/2 offset earlier,
      // so compute index:
      const landed = Math.floor(((normalized + 360) % 360) / degPer) % n;
      // But because we used finalDeg = ... + degPer/2 (to center), landed should be targetIndex.
      setTimeout(()=>{ // tiny delay for UX
        spinning = false;
        spinBtn.disabled = false;
        spinBtn.setAttribute('aria-pressed','false');
        centerLabel.textContent = "SPIN";
        const prize = prizes[targetIndex];
        resultText.innerHTML = `<strong>ຍິນດີ!</strong> ທ່ານໄດ້: <em>${prize}</em>`;
      }, 250);
    }
  }
  requestAnimationFrame(animate);
});
</script>
</body>
</html>
